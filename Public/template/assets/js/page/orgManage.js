define(["jquery","utils","config","accountAPI","layer","pagination","remodal"],function(n,t,e,o){var a=n("[data-remodal-id=addOrgModal]").remodal(),i=n("[data-remodal-id=changeOrgModal]").remodal(),r=n(".data-container table tbody input[type=checkbox]:checked"),c=n("body"),l={init:function(){this.render(),this.bindEvents()},render:function(){this.initModal(),this.fnGetList({},!0)},bindEvents:function(){this.onAdd(),this.onOpen(),this.onClose(),this.onDel(),this.onChange(),this.onSearch()},initModal:function(){n(".J_showAdd").on("click",function(){a.open()}),c.on("click",".J_showChangeOrg",function(){var t=n(this),e=t.parents("tr").find("td"),o=e.eq(1).text(),a=e.eq(2).text(),r=(e.eq(3).text(),e.eq(4).text(),e.eq(5).text()),c=e.eq(6).text(),l=n(".changeOrgModal .modalForm");l.find("input[name=orgId]").val(o),l.find("input[name=orgName]").val(a),l.find("input[name=orgLevel]").val(a),l.find("input[name=orgType]").val(a),l.find("input[name=phone]").val(r),l.find("input[name=cellphone]").val(c),i.open()}),n(document).on("closed",".remodal",function(t){n(this).find(".modalForm")[0].reset()})},onAdd:function(){var t=n(".addOrgModal .remodal-confirm");t.on("click",function(t){t.preventDefault();var e=n(this);if(!e.hasClass("disabled")){e.addClass("disabled");var i={};o.addOrg(i,function(n){console.log(n),a.close(),e.removeClass("disabled")})}})},onOpen:function(){n(".J_showOpen").on("click",function(){var a=t.getCheckedArr();a.length>0?layer.confirm("确定启用选中的列表项吗？",{icon:3},function(t){o.openOrg(a,function(t){r.each(function(){n(this).parents("tr").find("td").eq(7).text(e.orgStatus[1])})}),layer.close(t)}):layer.alert("请先选择要启用的列表项")})},onClose:function(){n(".J_showClose").on("click",function(){var a=t.getCheckedArr();a.length>0?layer.confirm("确定禁用选中的列表项吗？",{icon:3},function(t){o.closeOrg(a,function(t){r.each(function(){n(this).parents("tr").find("td").eq(7).text(e.orgStatus[2])})}),layer.close(t)}):layer.alert("请先选择要禁用的列表项")})},onDel:function(){n(".J_showDel").on("click",function(){var e=t.getCheckedArr();e.length>0?layer.confirm("确定删除选中的列表项吗？",{icon:3},function(t){o.delOrg(e,function(t){r.each(function(){n(this).parents("tr").remove()})}),layer.close(t)}):layer.alert("请先选择要删除的列表项",{icon:0})})},onChange:function(){n(".changeOrgModal .remodal-confirm").on("click",function(){var n={};o.changeOrg(n,function(n){layer.msg("修改成功")})})},onSearch:function(){var t=this;n(".J_search").on("click",function(){var e=n("input[name=type]").val(),o=n("input[name=level]").val(),a=n("input[name=orgName]").val()||"",i={page:1,type:e,superMemberid:o,name:a};t.fnGetList(i,!0)})},onSelectAll:function(){t.selectAll()},fnGetList:function(t,a){var i=this,r=n(".data-container table");o.searchOrg(t,function(o){if(console.log("获取机构管理列表 调用成功!"),"0"==o.list.length)return r.find("tbody").empty().html("<tr><td colspan='9'>暂无记录</td></tr>"),n(".pagination").hide(),!1;var c,l='<td><input type="checkbox"></td>',d="<td><a class='J_showChangeOrg text-blue' href='javascript:;'>修改</a></td>";if(n.each(o.list,function(n,t){var o="<td>"+t.memberid+"</td>",a="<td>"+t.name+"</td>",i="<td>"+e.orgType[t.type]+"</td>",r="<td>"+t.superMemberInfo+"</td>",s="<td>"+t.phone+"</td>",f="<td>"+t.cellphone+"</td>",u="<td>"+e.orgStatus[t.orgStatus]+"</td>";c+='<tr class="fadeIn animated">'+l+o+a+i+r+s+f+u+d+"</tr>"}),r.find("tbody").empty().html(c),a){var s=o.totalPages;s>0&&(console.log("页数："+s),n(".pagination").show().html("").createPage({pageCount:s,current:1,backFn:function(n){var e=t;e.page=n,i.fnGetList(t)}}))}})}};l.init()});